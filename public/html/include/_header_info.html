<html>
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<meta name="google-site-verification" content="wNcw9CFEc7uSGKA_6jhq6W4IvFbA6oGAomPWMHtrhN0" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="google-signin-client_id" content="708197277050-5f4v5h3tbj9s968i3d0sb3h2vag5p5i6.apps.googleusercontent.com">
</head>

<link rel='stylesheet' type="text/css" href='/css/style.css'>
<link rel="stylesheet" type="text/css" href="/libs/sementicUI/semantic.css">
<link rel='stylesheet' type="text/css" href='/libs/sementicUI/components/icon.min.css'>


<script src="/libs/sementicUI/libs/jquery-3.2.1.min.js"></script>
<script src="/libs/sementicUI/semantic.js"></script>
<script src="/js/common/common.min.js"></script>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.6/components/visibility.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.6/components/sidebar.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.6/components/transition.js"></script> -->
<body style="overflow-y : hidden !important;">
<!-- <div class="g-signin2" data-onsuccess="onSignIn"></div> -->
<script src="/libs/alertify/dist/js/alertify.js"></script>
<Script>

var make_Array_dateFormat = function( arr ){
	return arr[ 0 ] + "." + arr[ 1 ] + "."+ arr[ 2 ] + " "+ arr[ 3 ] + ":"+ arr[ 4 ] + ":"+ arr[ 5 ];
}

var recive_msg_render_board_chat = function(recieve_message){
	var _el = document.getElementById("comment_container");
	var url1 = "/api/Render/thtml/include_thtml?sid=" + window.service.cookie.getCookie('session') + "&fileNm=" + "render_chat_data.thtml"
	window.service.Request.req_GET_data__Callback(url1,function(result){
		if(result == 0) window.service.session.remove_deleteCookies_location_login();
		
		var _template = result;

		var io = recieve_message;
		var broadcast_msg = "";
		var msg = io.content;
		if( msg.indexOf("\n") != -1)
		{
			var _ta = msg.split("\n")
			var j = 0,jLen = _ta.length,jo;
			for(;j<jLen;++j)
			{
				jo = _ta[ j ];
				broadcast_msg += "<p>" + jo + "</p>\n";
			}

		}
		else
		{
			broadcast_msg = "<p>" + msg + "</p>";
		};

		var html_include_data = _template.replace( "{{image_url}}", io.member.image )
		.replace( "{{author}}", io.member.nm )
		.replace( "{{regist_date}}", make_Array_dateFormat( io.regist_date ) )
		.replace( "{{content}}", broadcast_msg );

		_el.insertAdjacentHTML( 'beforeend', html_include_data );

		var objDiv = document.getElementById("comment_wrap")
		objDiv.scrollTop = objDiv.scrollHeight;
	});
}


var recive_msg_render_board_todo = function( recieve_message ){
	var _el = document.getElementById("todo_container");

	var url1 = "/api/Render/thtml/include_thtml?sid=" + window.service.cookie.getCookie('session') + "&fileNm=" + "render_todo_data.thtml"
	window.service.Request.req_GET_data__Callback(url1,function(result){
		if(result == 0) window.service.session.remove_deleteCookies_location_login();
		
		var _template = result;

		var html_include_data = _template.replace( "{{title}}", recieve_message.title )
		.replace( "{{image_url}}", recieve_message.member.image )
		.replace( "{{memberNm}}", recieve_message.member.nm )
		.replace( "{{regist_date}}", make_Array_dateFormat( recieve_message.regist_date ) )
		.replace( "{{content}}", recieve_message.content )

		_el.insertAdjacentHTML( 'beforeend', html_include_data );
		
		var objDiv = document.getElementById("todo_wrap")
		objDiv.scrollTop = objDiv.scrollHeight;
	});
}



window.WebSocket = window.WebSocket || window.MozWebSocket;
if( window.service.cookie.getCookie('mid') ){
	var connection = new WebSocket('ws://13.125.22.207:8888?mid=' + window.service.cookie.getCookie('mid'));

	connection.addEventListener('open',function(){console.log("open") })
	connection.addEventListener('close',function(){ debugger; })
	connection.addEventListener('error',function(){ debugger; })
	connection.addEventListener('message',function( message ){
		console.log( message )
		var _tmp0 = JSON.parse( message.data )
		var recieve_message = JSON.parse( _tmp0.utf8Data )

		var renderData = JSON.parse( recieve_message )
		if(recieve_message.destination == "todo" ) recive_msg_render_board_todo( renderData )
		else recive_msg_render_board_chat( renderData )
	})
}

</script>
