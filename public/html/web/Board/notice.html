

<include>_header_info.html</include>
<script>window.service.session.checkSession();</script>
<include>navi.html</include>
<style>
#container{
	left: 0px !important; right: 0px !important; bottom: 0px !important; top: 0px !important;
}
#content{
	left: 0px !important; right: 0px !important; bottom: 0px !important; top: 0px !important;
}
#list{
	cursor: pointer;
	margin : 0px !important;border-bottom : 1px solid rgba(34, 36, 38, 0.15) !important;
}
#list:last-child{
	margin : 0px !important;border-bottom : 0 !important;
}
#notebook_list_item{
	cursor: pointer;
	margin : 0px !important;border-bottom : 1px solid rgba(34, 36, 38, 0.15) !important;
}
#notebook_list_item:last-child{
	margin : 0px !important;border-bottom : 0 !important;
}
#notebook_add_container{
	cursor: pointer;
	margin : 0px !important;border-bottom : 1px solid rgba(34, 36, 38, 0.15) !important;
	background-color: #eee;
}
#notebook_add_container:last-child{
	margin : 0px !important;border-bottom : 0 !important;
}

#note_add_container{
	cursor: pointer;
	margin : 0px !important;border-bottom : 1px solid rgba(34, 36, 38, 0.15) !important;
	background-color: #eee;
}
#note_add_container:last-child{
	margin : 0px !important;border-bottom : 0 !important;
}
.bottom_line{
	margin : 0px !important;border-bottom : 1px solid rgba(34, 36, 38, 0.15) !important;
}
</style>
<!-- <div class="ui centered grid">
	<div class="twelve wide column pad_t_60 pad_b_60"> -->

	<!----- contents ----->


	<div id="container" class="ui container">
		<!-- 2 -->
		<div class="ui horizontal segments" style="left: 0px !important; right: 0px !important; bottom: 0px !important; top: 0px !important; position: absolute; margin: 0px;overflow-y: hidden !important;">

			<!-- 3 -->
			<div id="div-PIMS-menu-list" class="ui vertical icon menu segment" style="padding : 0px; min-width: 40px !important; max-width: 40px !important; overflow-y: auto !important;">
				<a class="item" style="padding : 13px !important;" id="global_sidebar">
					<i class="bars fitted icon"  style="margin : 0px !important;"></i>
				</a>
				<a class="item" style="padding : 13px !important;" id="project_add">
					<i class="plus circle fitted icon"  style="margin : 0px !important;"></i>
				</a>
				<a class="item" style="padding : 13px !important;" id="test_sidebar1">
					<i class="check square fitted icon"  style="margin : 0px !important;"></i>
				</a>
				<a class="item" style="padding : 13px !important;" id="test_sidebar">
					<i class="comment fitted icon"  style="margin : 0px !important;"></i>
				</a>
			</div>

			<!-- 좌측 레이아웃이 더필요하다면 사용; -->
			<!--

			<div id="div-PIMS-menu-list" class="ui vertical menu segment" style="padding : 0px; min-width: 270px !important; max-width: 270px !important; overflow-y: auto !important;">

			</div>

			-->
			<!-- 좌측 레이아웃이 더필요하다면 사용; -->

			<div id="div-PIMS-VerticalContainer" class="ui fluid basic segment" style="min-height: auto !important; max-height: auto !important;overflow-y : hidden !important;">

				<div id="div-PIMS-GridContainer" class="ui grid" style="height : auto !important;">
					<div id="div-PIMS-HeaderContainer"class="sixteen wide fixed column" style="background-color : #eeeeee;">
						<div class="ui red horizontal label">Notice!</div>
						<a class="avatar">
							<img class="ui avatar Mini image" src="https://semantic-ui.com/images/avatar/small/elliot.jpg">
						</a>
					</div>
					<div class="sixteen wide column" id="div-PIMS-headerContainer" style="width: 100%;border-bottom : 1px solid rgba(34, 36, 38, 0.15) !important;min-height : 42px !important;">
						<div class="ui breadcrumb" id="brscm">
							<!-- <a class="section" id="brscm_1">Home</a>
							<span class="divider">/</span>
							<a class="section" id="brscm_2">Registration</a>
							<span class="divider" id="brscm_3">/</span>
							<div class="active section">Personal Information</div> -->
						</div>
					</div>
					<div class="sixteen wide column" id="div-PIMS-ViewContainer" style="min-height: 808px !important;">

						<div class="ui grid">
							<div class="two wide column" style="border-right : 1px solid rgba(34, 36, 38, 0.15) !important;padding : 0px !important;overflow-y: auto !important; min-height: 808px !important;height: 808px !important;">
								<div id="notebook_add_container" class="ui basic segment item">
									<div class="ui grid">
										<div class="eight wide column" id="project_title_div"><b id="project_title"></b></div>
										<div class="right floated right aligned eight wide column">
											<i class="plus icon right floated" id="notebook_add"></i>
											<!-- <i class="minus icon right floated" id="notebook_add"></i> -->
										</div>
									</div>
								</div>
								<div id="notebook_list"></div>
								<!-- <div id="list" class="ui basic segment item">
									<b>본문요약입니다.</b>
								</div>
								<div id="list" class="ui basic segment item">
									<b>본문요약입니다.</b>
								</div>
								<div id="list" class="ui basic segment item">
									<b>본문요약입니다.</b>
								</div> -->
							</div>

							<div class="two wide column" style="border-right : 1px solid rgba(34, 36, 38, 0.15) !important;padding : 0px !important;overflow-y: auto !important; min-height: 808px !important;height: 808px !important;">
								<div id="note_add_container" class="ui basic segment item" style="display : none;">
									<div class="ui grid">
										<div class="eight wide column" id="notebook_title_div"><b id="notebook_title"></b></div>
										<div class="right floated right aligned eight wide column">
											<i class="plus icon right floated" id="note_add"></i>
											<!-- <i class="minus icon right floated" id="notebook_add"></i> -->
										</div>
									</div>
								</div>
								<div id="sub_list"></div>
								<!-- <div id="list" class="ui basic segment item">
									<h4>제목입니다.</h4>
									<p>본문요약입니다.</p>
								</div>
								<div id="list" class="ui basic segment item">
									<h4>제목입니다.</h4>
									<p>본문요약입니다.</p>
								</div>
								<div id="list" class="ui basic segment item">
									<h4>제목입니다.</h4>
									<p>본문요약입니다.</p>
								</div> -->
							</div>

							<div class="twelve wide column" style="overflow-y: auto !important;padding : 0px !important;overflow-y: auto !important; max-height: 808px !important;">

								<div style="position:fixed;right :30px;bottom : 60px; z-index : 102;">

									<div class="ui buttons">
										<button class="ui button" id="modify" style="display : none;">수정</button>
										<button class="ui button" id="delete" style="display : none;">삭제</button>
										<button class="ui button" id="cancel" style="display : none;">취소</button>
										<button class="ui button" id="lists" style="display : none;">목록</button>
										<button class="ui button" id="write" style="display : none;">등록</button>
									</div>

								</div>

								<div class="ui basic segment" id="view_container">
								</div>
							</div>
						</div>
					</div>
					<div id="div-PIMS-FooterContainer" class="sixteen wide column"style="background-color : #eeeeee; bottom : 0px !important;position : relative !important;border-top : 1px solid rgba(34, 36, 38, 0.15) !important;">Copyright © B2LABS All Rights Reserved.</div>
				</div>
			</div>
		</div>
	</div>
	<!----- contents ----->

	<!-- 프로젝트 추가 모달 -->

	<div class="ui mini modal transition" id="project_add_modal">
		<div class="header">
			Project Add.
		</div>
		<div class="content">
			<div class="ui form">
				<div class="field">
					<label>Project Name</label>
					<input type="text" name="projec-name" placeholder="Project Name" id="project_nm">
				</div>
				<div class="field">
					<label>Description</label>
					<textarea id="project_desc"></textarea>
				</div>
				<div class="field">
					<button class="green fluid ui button" id="project_add_write">Add</button>
				</div>
				<div class="field">
					<button class="fluid ui button"  id="project_add_cancel">Cancel</button>
				</div>
			</div>
		</div>
	</div>

	<!-- 프로젝트 추가 모달 -->

	<!-- 노트북 추가 모달 -->

	<div class="ui mini modal transition" id="notebook_add_modal">
		<div class="header">
			Notebook Add.
		</div>
		<div class="content">
			<div class="ui form">
				<div class="field">
					<label>Notebook Name</label>
					<input type="text" name="notebook-name" placeholder="Notebook Name" id="notebook_nm">
				</div>
				<div class="field">
					<label>Description</label>
					<textarea id="notebook_desc"></textarea>
				</div>
				<div class="field">
					<button class="green fluid ui button" id="notebook_add_write">Add</button>
				</div>
				<div class="field">
					<button class="fluid ui button" id="notebook_add_cancel">Cancel</button>
				</div>
			</div>
		</div>
	</div>

	<!-- 노트북 추가 모달 -->

	<!-- 프로젝트선택모달 -->

	<div class="ui basic modal transition" id="project_select_modal">
		<div class="ui icon header">
			<i class="check icon"></i>
			Selct Project
		</div>
		<div class="content">
			<div id="project_list">
				<select class="ui dropdown fluid" id="project_list_select">
					<option value="">프로젝트를 선택하세요</option>
				</select>
			</div>
		</div>
	</div>

	<!-- 프로젝트선택모달 -->
<include>_footer_info.html</include>
<script></script>
<script type="text/javascript">

//editor 라이브러리 로드;


var sNew = document.createElement("script");
sNew.async = true;
sNew.src = "libs/ckeditor/ckeditor.js";
var s0 = document.getElementsByTagName('script')[0];
s0.parentNode.insertBefore(sNew, s0);
//editor 라이브러리 로드;

//--------------------------------------------------variable;
var notebook_detail_data = [];
var project_list_data = [];
var notebook_list_data = [];

var current_view_doc__data = {};
var current_project__data = {};
var current_notebook__data = {};
var current_note_chat__data = {
	data : []
	, limit : 20
	, skip : 0
};

//------------------------------_el;
var _el_div__view_container = document.getElementById("view_container");
var _el_div__sub_list = document.getElementById('sub_list')
var _el_btn__project_add = document.getElementById( "project_add" );
var _el_btn__notebook_add = document.getElementById( "notebook_add" );
var _el_btn__project_add_write = document.getElementById( "project_add_write" )
var _el_btn__project_add_cancel = document.getElementById( "project_add_cancel" )
var _el_btn__notebook_add_write = document.getElementById( "notebook_add_write" )
var _el_btn__notebook_add_cancel = document.getElementById( "notebook_add_cancel" )
//------------------------------_el;
//------------------------------ event;
document.getElementById("global_sidebar").addEventListener("click",function(){
	$('.ui.left.sidebar')
	.sidebar('setting', 'transition', 'overlay')
	.sidebar('toggle');
})

document.getElementById("notebook_list").addEventListener("click",function(e){

	var pe = e.currentTarget.children
	var te = check_dom( e.target, "notebook_list_item" )

	var i = 0,iLen = pe.length,io;
	for(;i < iLen;++i){
		io = pe[ i ]
		if( io == te ){
			console.log( i )
			current_notebook__data = notebook_list_data[ i ]

			document.getElementById("note_add_container").setAttribute("style","display : block;")
			document.getElementById("notebook_title").innerText = current_notebook__data.nm

			make_sub_list( current_notebook__data.cd );

			var _t0 = document.getElementById( "view_document" )
			if( _t0 ) if( document.getElementById("view_document").firstChild ) while( document.getElementById("view_document").firstChild ) document.getElementById("view_document").removeChild( _t0.firstChild );

			make_brcm_2();

		}
	}
})

_el_btn__notebook_add_cancel.addEventListener("click",function(){
	document.getElementById( "notebook_nm" ).value = "";
	document.getElementById( "notebook_desc" ).value = "";
	$('#notebook_add_modal').modal('hide');
})

document.getElementById( "project_title_div" ).addEventListener("click",function(){

	$('#project_select_modal').modal('setting', 'closable', true).modal('show');
})

_el_btn__project_add_cancel.addEventListener("click",function(){
	document.getElementById( "project_nm" ).value = "";
	document.getElementById( "project_desc" ).value = "";
	$('#project_add_modal').modal('hide');
})

_el_btn__project_add.addEventListener("click",function(){
	$('#project_add_modal').modal('show');
	console.log("_el_btn__project_add")
	_el_btn__project_add_write.addEventListener("click", write_project );
})

_el_btn__notebook_add.addEventListener("click",function(){
	$('#notebook_add_modal').modal('toggle');
	console.log("_el_btn__project_add")
	_el_btn__notebook_add_write.addEventListener("click",write_notebook );
})

document.getElementById("test_sidebar").addEventListener("click",function(){
	$('.ui.right.sidebar.comment_sidebar').sidebar('setting', 'transition', 'overlay').sidebar("show" )
	if( !document.getElementById("comment") )
	{
		chat_board_get_list();
	}
	var objDiv = document.getElementById("comment_wrap")
		objDiv.scrollTop = objDiv.scrollHeight;
})

document.getElementById("test_sidebar1").addEventListener("click",function(){
	$('.ui.right.sidebar.todo_sidebar').sidebar('setting', 'transition', 'overlay').sidebar("show" )
})

document.getElementById("comment_wrap").addEventListener("scroll",function(){
	var comment_wrap = document.getElementById("comment_wrap");
	if( comment_wrap.scrollTop == 0 )
	{
		chat_board_get_list()
	}
})
var _el_div__sub_list_click = function(e){

	var pe = e.currentTarget.children
	var te = check_dom( e.target, "list" )

	var i = 0,iLen = pe.length,io;
	for(;i < iLen;++i){
		io = pe[ i ]
		if( io == te ){
			console.log( i )
			req_detail_by__id( notebook_detail_data[ i ]._id )
		}
	}
}


//------------------------------ event;
//------------------------------ addEventListener;
_el_div__sub_list.addEventListener("click",_el_div__sub_list_click)
//------------------------------ addEventListener;
//------------------------------ btn;
var btn_object = { modify : "none", delete : "none", delete : "none", cancel : "none", lists : "none", write : "none"}

var btn_control = function( o ){
	for( var s in btn_object )
	{
		if( o[ s ] ) document.getElementById( s ).style.display = o[ s ];
		else document.getElementById( s ).style.display = btn_object[ s ];
	}
	return;
}

//------------------------------ btn;
//--------------------------------------------------variable;

/*
	//ToDo 정리해야할 함수;
	function htmlEntities(str) {
	    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
	}

	function htmlEntities3(str) {
	    return String(str).replace(/(\S+)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g, '')
		.replace(/^<table.*[">$]/g, '<table class="ui celled table">')
		.replace(/<span >/g, '')
		.replace(/<\/span>/g, '')
		.replace(/<td >/g, '<td>')
		.replace(/&nbsp;/g, '')
	//	.replace(//g, '<td>')
	}
*/

//--------------------------------------------------function;
var _el_removeChild = function( el ){
	if( el.firstChild ) while( el.firstChild ) el.removeChild( el.firstChild );
}
/**
*
*/
var htmlEntities =  function(str){
	return String(str).replace(/(\S+)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g, '')
	.replace(/^<table.*[">$]/g, '<table class="ui celled table">')
	.replace(/<span >/g, '')
	.replace(/<\/span>/g, '')
	.replace(/<td >/g, '<td>')
	.replace(/&nbsp;/g, '');
//	.replace(//g, '<td>')
};
/**
*
*/
var make_Array_dateFormat = function( arr ){
	return arr[ 0 ] + "." + arr[ 1 ] + "."+ arr[ 2 ] + " "+ arr[ 3 ] + ":"+ arr[ 4 ] + ":"+ arr[ 5 ];
}
/**
 * [write_doc description]
 * @type {[type]}
 */
 var check_dom = function( e, str ){
	 if( e.getAttribute("id") == str ) return e
	 else if( e.getAttribute("id") == "sub_list" ) return "";
	 else return check_dom( e.parentElement, "list" )
 }
//--------------------------------------------------function;
var render_chat_data = function( arr ){
	var i = 0,iLen = arr.length,io;
	for(;i<iLen;++i)
	{

		io = arr[ i ]

		var div0 = document.createElement("div");
			div0.setAttribute("class","comment");
			div0.setAttribute("id","comment")

		var a = document.createElement("a");
			a.setAttribute("class","avatar")

		var img = document.createElement("img");
			img.src = io.member.image;
			img.setAttribute("style","height : 35px !important;")

			a.appendChild( img )

		var div1 = document.createElement("div")
			div1.setAttribute("class","content")

		var a0 = document.createElement("a")
			a0.setAttribute("class","author")
			a0.appendChild( document.createTextNode( io.member.nm ) )

			div1.appendChild( a0 )

		var div2 = document.createElement("div")
			div2.setAttribute("class","metadata")

		var div3 = document.createElement("div")
			div3.setAttribute("class","date")
			div3.appendChild( document.createTextNode( make_Array_dateFormat( io.regist_date ) ))

			div2.appendChild( div3 )
			div1.appendChild( div2 )

		var div4 = document.createElement("div")
			div4.setAttribute("class","text")

		// var p = document.createElement( "p" )

			var broadcast_msg = "";
			var msg = io.content;
			if( msg.indexOf("\n") != -1)
			{
				var _ta = msg.split("\n")
				var j = 0,jLen = _ta.length,jo;
				for(;j<jLen;++j)
				{
					jo = _ta[ j ];
					broadcast_msg += "<p>" + jo + "</p>\n"
				}

			}
			else
			{
				broadcast_msg = "<p>" + msg + "</p>"
			}
			// p.appendChild( document.createTextNode( recieve_message.utf8Data ) )
			div4.innerHTML = broadcast_msg

			// div4.appendChild( p )
			div1.appendChild( div4 )

		var div5 = document.createElement("div")
			div5.setAttribute("class","actions")

		var a1 = document.createElement("a")
			a1.setAttribute("class","reply")
			a1.appendChild( document.createTextNode("Reply") );

			div5.appendChild( a1 )
			div1.appendChild( div5 )

		div0.appendChild( a )
		div0.appendChild( div1 )

		if( document.getElementById("comment_container").childNodes[ 0 ] )
		{
			document.getElementById("comment_container").insertBefore( div0, document.getElementById("comment_container").childNodes[ 0 ] )
		}
		else
		{
			document.getElementById("comment_container").appendChild( div0 )
		}
	}
}


/**
 * 
*/
var chat_board_get_list = function(){

var url = "/api/Chat/board/get_list?sid=" + window.service.cookie.getCookie('session') 
		+ "&cd$doc=" + current_view_doc__data.cd
		+ "&limit=" + current_note_chat__data.limit
		+ "&skip=" + current_note_chat__data.skip;

	window.service.Request.req_GET_data__Callback(url,function(result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result )
		//_el_removeChild( document.getElementById("comment_container") );
		render_chat_data( data )
		current_note_chat__data.data.push( data );
		current_note_chat__data.skip += 10
	})
}


var make_brcm_1 = function(){
	var _t0 = document.getElementById("brscm")

	if( document.getElementById( "brscm_1" ) )
	{
		//document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_1" ) );
		if( current_project__data ) document.getElementById( "brscm_1" ).innerText = current_project__data.nm;
		if( document.getElementById( "brscm_2" ) ) document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_2" ) );
		if( document.getElementById( "brscm_3" ) ) document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_3" ) );
		if( document.getElementById( "brscm_2_divider" ) ) document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_2_divider" ) );
		if( document.getElementById( "brscm_3_divider" ) ) document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_3_divider" ) );
	}
	else
	{
		var a = document.createElement("a")
			a.setAttribute("class","section");
			a.setAttribute("id","brscm_1");
			a.appendChild( document.createTextNode( current_project__data.nm ) );

		_t0.appendChild( a )
	}
}

var make_brcm_2 = function(){
	var _t0 = document.getElementById("brscm")

	if( document.getElementById( "brscm_2" ) )
	{
		//document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_2" ) );
		document.getElementById( "brscm_2" ).innerText = current_notebook__data.nm;
		if( document.getElementById( "brscm_3_divider" ) ) document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_3_divider" ) );
		if( document.getElementById( "brscm_3" ) ) document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_3" ) );
	}
	else
	{
		var a = document.createElement("a")
			a.setAttribute("class","section");
			a.setAttribute("id","brscm_2");
			a.appendChild( document.createTextNode( current_notebook__data.nm ) );

		var i = document.createElement("i")
			i.setAttribute("class","right chevron icon divider");
			i.setAttribute("id","brscm_2_divider");

		_t0.appendChild( i )
		_t0.appendChild( a )
	}

}

var make_brcm_3 = function(){
	var _t0 = document.getElementById("brscm")

	if( document.getElementById( "brscm_3" ) )
	{
		//document.getElementById( "brscm" ).removeChild( document.getElementById( "brscm_3" ) );
		document.getElementById( "brscm_3" ).innerText = current_view_doc__data.title;
	}
	else
	{
		var a = document.createElement("a")
			a.setAttribute("class","section");
			a.setAttribute("id","brscm_3");
			a.appendChild( document.createTextNode( current_view_doc__data.title ) );

		var i = document.createElement("i")
			i.setAttribute("class","right chevron icon divider");
			i.setAttribute("id","brscm_3_divider")

		_t0.appendChild( i )
		_t0.appendChild( a )
	}
}


var make_project_list = function(){
	var url = "/api/Category/project/get_list?sid=" + window.service.cookie.getCookie('session');

	_el_btn__project_add_write.removeEventListener("click",write_project);
	document.getElementById( "notebook_add_container" ).setAttribute("style","display : none;")

	window.service.Request.req_GET_data__Callback(url,function(result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result );

		console.log( data );
		project_list_data = data;

		var _t0 = document.getElementById("project_list_select")

		document.getElementById( "notebook_add_container" ).setAttribute( "style", "display : none;" )
		_el_removeChild( _t0 );
		_el_removeChild( document.getElementById("notebook_list") );

		var option = document.createElement("option")
			option.setAttribute( "value", "" )
			option.appendChild( document.createTextNode( "프로젝트를 선택하세요" ) )

		_t0.appendChild( option )

		var i = 0,iLen = data.length,io
		for(;i<iLen; ++i)
		{
			io = data[ i ];
			var option = document.createElement("option")
				option.setAttribute( "value", i )
				option.appendChild( document.createTextNode( io.nm ) )

			_t0.appendChild( option )
		}
		document.getElementById("project_list_select").addEventListener("change",function(e){
			console.log(e.target.selectedOptions[ 0 ].value)
			var idx = e.target.selectedOptions[ 0 ].value;
			if( idx == "" )
			{
				_el_removeChild( document.getElementById( "notebook_list" ));
				_el_removeChild( document.getElementById( "sub_list" ));
				_el_removeChild( document.getElementById( "view_container" ));
				_el_removeChild( document.getElementById( "brscm" ));

				document.getElementById( "notebook_add_container" ).setAttribute("style","display : none;")
				return;
			}

			document.getElementById("note_add_container").setAttribute("style","display : none;")
			document.getElementById("notebook_title").innerText = "";


			current_project__data = project_list_data[ idx ];
			make_brcm_1();
			document.getElementById( "project_title" ).innerText = current_project__data.nm
			$('#project_select_modal').modal('hide')
			make_notebook_list( current_project__data.cd );
		})

		_el_removeChild( document.getElementById( "notebook_list" ));
		_el_removeChild( document.getElementById( "sub_list" ));
		_el_removeChild( document.getElementById( "view_container" ));
		_el_removeChild( document.getElementById( "brscm" ));

		if( current_project__data.cd )
		{
			make_brcm_1();
			document.getElementById( "project_title" ).innerText = current_project__data.nm
			make_notebook_list( current_project__data.cd );
		}
	})
}

var make_notebook_list = function( cd$project ){

	_el_btn__notebook_add_write.removeEventListener("click",write_notebook);

	var _t0 = document.getElementById("notebook_list")

	if( _t0.firstChild ) while( _t0.firstChild ) _t0.removeChild( _t0.firstChild );

	var url = "/api/Category/notebook/get_list?sid=" + window.service.cookie.getCookie('session') + "&cd$project=" + cd$project;
	window.service.Request.req_GET_data__Callback(url,function(result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result );

		console.log( data );
		notebook_list_data = data;

		var _el_div__sub_list = document.getElementById( "sub_list" )
		if( _el_div__sub_list ) if( _el_div__sub_list.firstChild ) while( _el_div__sub_list.firstChild ) _el_div__sub_list.removeChild( _el_div__sub_list.firstChild );
		var _el_div__view_container = document.getElementById( "view_document" )
		if( _el_div__view_container ) if( _el_div__view_container.firstChild ) while( _el_div__view_container.firstChild ) _el_div__view_container.removeChild( _el_div__view_container.firstChild );

		document.getElementById( "notebook_add_container" ).setAttribute( "style", "display : block;" )

		_el_removeChild( _t0 );

		var i = 0,iLen = data.length,io
		for(;i<iLen; ++i)
		{
			io = data[ i ];
			var div = document.createElement("div")
				div.setAttribute( "id", "notebook_list_item" )
				div.setAttribute( "class", "ui basic segment item" )

				div.appendChild( document.createTextNode( io.nm ) )

			_t0.appendChild( div )
		}

	})
}

/**
* 리스트의 문서디테일을 가져와 화면에 그린다.
*/
var req_detail_by__id = function( _id ){
	var url = "/api/Board/notice/detail_view_by__id?sid=" + window.service.cookie.getCookie('session') + "&_id=" + _id
	if( document.getElementById('add_doc_con') )
	{
		 _el_div__view_container.removeChild( document.getElementById('add_doc_con') );
	}

	window.service.Request.req_GET_data__Callback(url,function(result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result );

		console.log( data );
		current_view_doc__data = data[ 0 ];

		var regist_date = make_Array_dateFormat( data[ 0 ].regist_date );
		var title = data[ 0 ].title
		var content = data[ 0 ].content

		if( document.getElementById("view_document") )
		{
			_el_div__view_container.removeChild( document.getElementById("view_document") );
		}

		var div_content = document.createElement("div")
			div_content.setAttribute("class","ui basic segment item")
			div_content.setAttribute("id","view_document")

		var div0 = document.createElement("div")
			div0.setAttribute("class", "ui basic segment item");

		var h2 = document.createElement("h2")
			h2.setAttribute("id", "view_document_title");
		var h2_text = document.createTextNode( title );

		var p = document.createElement("p")
			p.setAttribute("id", "view_document_date");
		var p_text = document.createTextNode( regist_date );

		var div1 = document.createElement("div")
			div1.setAttribute("class", "ui basic segment");
			div1.setAttribute("id", "view_document_content");
			div1.innerHTML = content;

		h2.appendChild( h2_text );
		p.appendChild( p_text )
		div0.appendChild( h2 );
		div0.appendChild( p );
		div_content.appendChild( div0 );
		div_content.appendChild( div1 );

		_el_div__view_container.appendChild( div_content )

		make_brcm_3();

		if( document.getElementById('add_doc_con') )
		{
			document.getElementById("view_container").removeChild(document.getElementById("add_doc_con"));
		}

		//---------- Button;
		document.getElementById("modify").style.display = "block";
		document.getElementById("delete").style.display = "block";

		var btn_control_obj = {modify : "block", delete : "block"}
		btn_control( btn_control_obj );
		//---------- Button;

		document.getElementById("modify").removeEventListener( "click",update_doc )
		document.getElementById("modify").addEventListener( "click",modify_doc )
		document.getElementById("delete").addEventListener( "click",delete_doc )
	})
}

/**
 * 서브리스트를 만드는 함수
 * @return {[type]} [description]
 */
var make_sub_list = function( cd$notebook ){

	var url = "/api/Board/notice/get_list?sid=" + window.service.cookie.getCookie('session') + "&cd$notebook=" + cd$notebook;


	window.service.Request.req_GET_data__Callback(url,function(result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result )

		_el_div__sub_list.innerHTML = "";//dom 초기화;

		var i = 0,iLen = data.length,io;
		for(; i<iLen; ++i ){

			io = data[ i ];
			var div0 = document.createElement("div")
				div0.setAttribute("id", "list");
				div0.setAttribute("class", "ui basic segment item bottom_line");
				div0.setAttribute("idx", io._id);

			var b = document.createElement("b")
			var b_text = document.createTextNode( io.title );

			var div__id = document.createElement("div")
				div__id.setAttribute("id", "list_id");
				div__id.setAttribute("style", "display : none;");
			var div__id_text = document.createTextNode( io._id )

			var div1 = document.createElement("div")
				div1.setAttribute("id", "sub_list_date");
				div1.setAttribute("class", "pad_b_10");

			var div1_text = document.createTextNode( make_Array_dateFormat( io.regist_date ) );

			div__id.appendChild( div__id_text );
			b.appendChild( b_text );
			div1.appendChild( div1_text );
			div0.appendChild( div__id )
			div0.appendChild( b )
			div0.appendChild( div1 )
			_el_div__sub_list.appendChild( div0 )
		}

		notebook_detail_data = data;
	})
}

var write_project = function(){

	var project_nm =  document.getElementById("project_nm").value;
	var project_desc = document.getElementById("project_desc").value;

	var url = "/api/Category/project/write?sid=" + window.service.cookie.getCookie('session')
			+ "&project_nm=" + project_nm
			+ "&project_desc=" + project_desc

	window.service.Request.req_GET_data__Callback(url,function(result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result );

		document.getElementById( "project_nm" ).value = "";
		document.getElementById( "project_desc" ).value = "";
		$('#project_add_modal').modal('hide');

		current_project__data = data;

		make_project_list();
	})
}

var write_notebook = function(){

	var notebook_nm =  document.getElementById("notebook_nm").value;
	var notebook_desc = document.getElementById("notebook_desc").value;

	var url = "/api/Category/notebook/write?sid=" + window.service.cookie.getCookie('session')
			+ "&notebook_nm=" + notebook_nm
			+ "&notebook_desc=" + notebook_desc
			+ "&cd$project=" + current_project__data.cd
			+ "&nm$project=" + current_project__data.nm

	window.service.Request.req_GET_data__Callback(url,function(result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result );

		document.getElementById( "notebook_nm" ).value = "";
		document.getElementById( "notebook_desc" ).value = "";
		$('#notebook_add_modal').modal('hide');

		make_notebook_list( current_project__data.cd );
	})
}

/**
*문서를 등록한다.
*/
var write_doc = function(){

	var htmlEntities =  function(str){
		return String(str).replace(/(\S+)=["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g, '')
		.replace(/^<table.*[">$]/g, '<table class="ui celled table">')
		.replace(/<span >/g, '')
		.replace(/<\/span>/g, '')
		.replace(/<td >/g, '<td>')
		.replace(/&nbsp;/g, '')
		.toString("utf8")
	//	.replace(//g, '<td>')
	};

	var url = "/api/Board/notice/write"
	var title = document.getElementById("title").value
	var data = "sid=" + window.service.cookie.getCookie('session')
			+ "&data=" + htmlEntities( CKEDITOR.instances.editor.getData() )
			+ "&title=" + title
			+ "&cd$project=" + current_project__data.cd
			+ "&cd$notebook=" + current_notebook__data.cd;

	window.service.Request.req_POST_data__Callback(url,encodeURIComponent( data ),function( result ){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}

		var data = JSON.parse( result );
		console.log( data );
		console.log( "--등록완료--" );

		_el_div__view_container.removeChild( document.getElementById('add_doc_con') );

		make_sub_list( current_notebook__data.cd );//서브리스트 갱신;

		req_detail_by__id( data._id );//view 데이터 갱신;
	})
}

/**
 * [description]
 * @return {[type]} [description]
 */
var write_cancel = function(){

	//Dom 삭제;
	document.getElementById("view_container").removeChild(document.getElementById("add_doc_con"));

	if( current_view_doc__data._id != -1) req_detail_by__id( current_view_doc__data._id )
	//----------;

}

/**
 * [description]
 * @param  {[type]} data [description]
 * @return {[type]}      [description]
 */
var update_doc = function( data ){

	var url = "/api/Board/notice/update"
	var title = document.getElementById("title").value
	var data = "sid=" + window.service.cookie.getCookie('session')
	+ "&_id=" + current_view_doc__data._id
	+ "&data=" + htmlEntities(CKEDITOR.instances.editor.getData())
	+ "&title=" + title;

	window.service.Request.req_POST_data__Callback(url,data,function( result){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		var data = JSON.parse( result );

		console.log( data );
		console.log( "--수정완료--" )

		document.getElementById("view_container").removeChild(document.getElementById("add_doc_con"));

		make_sub_list( current_notebook__data.cd );
		req_detail_by__id( data )
	})
}

/**
 * [description]
 * @return {[type]} [description]
 */
var modify_doc = function(){

	//수정폼 로드;
	add_doc();

	document.getElementById("title").value = document.getElementById("view_document_title").innerText;
	CKEDITOR.instances.editor.setData( document.getElementById("view_document_content").innerHTML );

	//----------;
	var btn_control_obj = {
		modify : "block"
		, cancel : "block"
	}
	btn_control( btn_control_obj );
	//----------;

	document.getElementById("modify").removeEventListener("click",modify_doc)
	document.getElementById("modify").addEventListener("click",update_doc)
}

/**
 * [description]
 * @return {[type]} [description]
 */
var delete_doc = function(){

	var url = "/api/Board/notice/delete?sid=" + window.service.cookie.getCookie('session')
	+ "&_id=" + current_view_doc__data._id

	window.service.Request.req_GET_data__Callback(url,function( result ){
		if(result == 0){
			window.service.session.remove_deleteCookies()
			location.href = "/Member/login";
		}
		console.log( result );
		console.log( "--삭제완료--" )

		make_sub_list( current_notebook__data.cd );
		document.getElementById("view_container").removeChild(document.getElementById("view_document"));
	})
}

var add_doc = function(){

	if( document.getElementById( "view_document" ) )
	{
		document.getElementById( "view_document" ).setAttribute("style","display : none;");
	}

	var div_con =  document.createElement("div");
		div_con.setAttribute("id", "add_doc_con");

	var div0 = document.createElement("div")
		div0.setAttribute("class", "ui fluid icon input");
		div0.setAttribute("style", "margin-bottom : 14px;");

	var input = document.createElement("input")
		input.setAttribute("type", "text");
		input.setAttribute("placeholder", "제목을 입력하세요");
		input.setAttribute("id", "title");

	var textarea = document.createElement("textarea")
		textarea.setAttribute("class", "ckeditor");
		textarea.setAttribute("rows", "10");
		textarea.setAttribute("name", "contents");
		textarea.setAttribute("id", "editor");
		textarea.setAttribute("style", "display : none;");

	div0.appendChild( input )
	div_con.appendChild( div0 );
	div_con.appendChild( textarea );

	_el_div__view_container.appendChild( div_con );

	//에디터 로드;
	CKEDITOR.replace( 'contents',{
		customConfig : './config.js',
		width: '100%',
		height: '600px',
		toolbarStartupExpanded : false
	});

	//필드초기화;
	document.getElementById("title").value = "";
	CKEDITOR.instances.editor.setData("내용을 입력해주세요")

	//----------;
	var btn_control_obj = {
		cancel : "block"
		, write : "block"
	}
	btn_control( btn_control_obj );
	//----------;

	document.getElementById("write").addEventListener("click",write_doc)
	document.getElementById("cancel").addEventListener("click", write_cancel );

}
/**
 * [description]
 * @return {[type]} [description]
 */
var Initialize = function(){

	make_project_list();
	$('#project_select_modal').modal('setting', 'closable', false).modal('show');
	//----------;
	var btn_control_obj = {add : "block"}
	btn_control( btn_control_obj );
	//----------;
	document.getElementById("note_add").addEventListener("click", add_doc );
}

Initialize();

</script>
